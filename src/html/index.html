<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <title>GUIA</title>
        <meta http-equiv="content-type"
              content="text/html;charset=utf-8" />

        <!-- Include stylesheets -->
        <link href="/css/bootstrap.css" type="text/css" rel="stylesheet" />
        <style type="text/css">
            /* Override some defaults */
            html, body {
                background-color: #eee;
            }
            body {
                padding-top: 40px; /* 40px to make the container go all the way to the bottom of the topbar */
            }
            .container > footer p {
                text-align: center; /* center align it with the container */
            }
            .container {
                width: 820px; /* downsize our container to make the content feel a bit tighter and more cohesive. NOTE: this removes two full columns from the grid, meaning you only go to 14 columns and not 16. */
            }

            /* The white background content wrapper */
            .content {
                background-color: #fff;
                padding: 20px;
                margin: 0 -20px; /* negative indent the amount of the padding to maintain the grid system */
                -webkit-border-radius: 0 0 6px 6px;
                -moz-border-radius: 0 0 6px 6px;
                border-radius: 0 0 6px 6px;
                -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.15);
                -moz-box-shadow: 0 1px 2px rgba(0,0,0,.15);
                box-shadow: 0 1px 2px rgba(0,0,0,.15);
            }

            /* Page header tweaks */
            .page-header {
                background-color: #f5f5f5;
                padding: 20px 20px 10px;
                margin: -20px -20px 20px;
            }

            /* Styles you shouldn't keep as they are for displaying this base example only */
            .content .span10,
            .content .span4 {
                min-height: 500px;
            }
            /* Give a quick and non-cross-browser friendly divider */
            .content .span4 {
                margin-left: 0;
                padding-left: 19px;
                border-left: 1px solid #eee;
            }

            .topbar .btn {
                border: 0;
            }

        </style>

        <!-- Include browserify library and socket.io -->
        <script type="text/javascript" src="/browserify.js"></script>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script type="text/javascript" src="/js/sha512.js"></script>

        <!-- Bootstrap application frontend -->
        <script type="text/javascript" src="/js/bootstrap.js"></script>

        <!-- Load views -->
        <script type="text/javascript" src="/js/views/NavigationView.js"></script>
        <script type="text/javascript" src="/js/views/WelcomeView.js"></script>
        <script type="text/javascript" src="/js/views/ContactView.js"></script>

        <!-- Start installation -->
        <script type="text/javascript">
            var WorkspaceRouter = Backbone.Router.extend({
                routes: {
                    "":         "welcome",
                    "/contact": "contact",
                    "*actions": "welcome"
                },
                
                updateNavigation: function (req) {
                    if (req == "") {
                        $('.nav > li.active').removeClass('active');
                        $('.nav > li:nth-child(1)').addClass('active');
                    } else {
                        $('.nav > li.active').removeClass('active');
                        $('.nav > li > a[href="#' + req + '"]').parent().addClass('active');
                    }
                },
                
                welcome: function () {
                    this.updateNavigation("");
                    var welcome = new WelcomeView({el: $('#body')});
                    
                    welcome.render();
                },

                contact: function () {
                    this.updateNavigation('/contact');
                    
                    var contact = new ContactView({el: $('#body')});
                    contact.render();
                }
            });
            
            var NavigationCollection = require('./NavigationCollection');
            
            $(document).ready(function () {
                /*$(window).bind('hashchange', function () {
                    console.log()
                });*/
                new WorkspaceRouter();
                Backbone.history.start();
                
                var navigationCollection = new NavigationCollection
                var nav = new NavigationView({el: $('.topbar'), collection: navigationCollection});
                
                navigationCollection.bind('add', function (item) {
                    console.log(item);
                    var hash = window.location.hash;
                    
                    if (window.location.hash == "" || window.location.hash == "#/") {
                        hash = '#';
                    }
                    
                    var href = $('<a></a>').attr('href', item.get('link')).text(item.get('title'));
                    var li = $('<li></li>').append(href);
                    
                    if (item.get('link') == hash) {
                        li.addClass('active');
                    }
                    
                    $('.nav').append(li);
                });
            });
        </script>

        <!-- <script type="text/template" id="search_template" src="/program"></script> -->
        <!-- Loading templates -->
        <script type="text/template" id="WelcomeViewTemplate">
            <%- partial('templates/welcome') %>
        </script>
        
        <script type="text/template" id="ContactViewTemplate">
            <%- partial('templates/contact') %>
        </script>
        
        <script type="text/template" id="LoginFormTemplate">
            <%- partial('templates/LoginForm') %>
        </script>
    </head>

    <body>
        <div class="topbar">
            <div class="fill">
                <div class="container">
                    <a href="#" class="brand">GUIA</a>
                    <ul class="nav">
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="content" id="body">

            </div>
            <footer>
                <p>&copy; <a href="http://github.com/kersten">Kersten Burkhardt</a> 2011</p>
            </footer>
        </div>
    </body>
</html>