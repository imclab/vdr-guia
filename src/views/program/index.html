<script type="text/javascript">
    $(document).ready(function () {
        $('#switch').click(function () {
            console.log("Switching vdr to channel: "+ $(this).attr('channel'));
            
            $.post('<%= switchUrl %>/' + $(this).attr('channel'), function () {
                $('#overlay').css({
                    opacity: 0.5,
                    width: $(document).width(),
                    height: $(document).height()
                }).show();

                $('#dialog').css({
                    top: (($(window).height() - $(this).outerHeight()) / 2) + $(window).scrollTop() + "px",
                    left: (($(window).width() - $(this).outerWidth()) / 2) + $(window).scrollLeft() + "px"
                }).show();
            }).error(function () {
                $('#overlay').css({
                    opacity: 0.5,
                    width: $(document).width(),
                    height: $(document).height()
                }).show();

                $('#errordialog').css({
                    top: (($(window).height() - $(this).outerHeight()) / 2) + $(window).scrollTop() + "px",
                    left: (($(window).width() - $(this).outerWidth()) / 2) + $(window).scrollLeft() + "px"
                }).show();
            });

            $('.btn_ok').click(function () {
                $('#overlay').hide();
                $('.modal').hide();
            });
        });
        
        $('.btn_timer').click(function () {
            if ($(this).attr('active') == "true") {
                $(this).attr('src', '/img/devine/black/Circle.png');
                $(this).attr('active', "false");
            } else {
                $(this).attr('src', '/img/devine/black/Circle-2.png');
                $(this).attr('active', "true");
            }
            
            console.log($(this).attr('eventid'));
        });
    });
</script>
        
<div class="page-header">
    <h1>
        Program
        <small>What's running on <strong><%= channel.name %></strong> <img id="switch" channel="<%= channel.channel_id %>" style="cursor: pointer;" src="/img/devine/black/TV.png" width="20px" height="20px" title="Switch to this channel" /></small>
    </h1>
</div>

<div class="row">
    <div class="span16 columns">
        <table class="zebra-striped">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    <th style="width: 100px;">Airtime</th>
                    <th>Title</th>
                </tr>
            </thead>
            <tbody>
                <% if (channelEpg.length) {
                channelEpg.forEach(function (epg, i) {
                var date = new Date();

                date.setTime(epg.start_time * 1000);
                var start = ((date.getHours() < 10) ? 0 : '') + '' + date.getHours() + ':' + ((date.getMinutes() < 10) ? 0 : '') + '' + date.getMinutes();

                date.setTime((epg.start_time + epg.duration) * 1000);
                var end = ((date.getHours() < 10) ? 0 : '') + '' + date.getHours() + ':' + ((date.getMinutes() < 10) ? 0 : '') + '' + date.getMinutes();
                %>
                <tr>
                    <td style="width: 20px; text-align: center;"><img class="btn_timer" eventid="<%= epg.id %>" style="cursor: pointer;" src="/img/devine/black/Circle.png" width="16px" height="16px" title="Record this show" /></td>
                    <td><%= start %> - <%= end %></td>
                    <td><%= epg.title %></td>
                </tr>
                <% })
                }%>
            </tbody>
        </table>
        <% if (paginator.total > 10) {
            var query = '&chan=' + channelNumber;
        %>
        <div class="span16 columns">
            <div class="pagination" style="padding-left: 25%;">
                <ul>
                    <li class="prev <% if (paginator.cur == 1) {%>disabled<% } %>">
                        <a<% if (paginator.cur != 1) {%> href="/program?site=<%= paginator.previous %><%= query %>"<% } %>>← Previous</a>
                    </li>
                    <% var cnt = paginator.cur + 3;
                    var start = paginator.cur;
                    if (paginator.sites < 9) {
                        cnt = paginator.sites + 1;
                        start = 1;
                    } else {
                        if (paginator.cur != 1) {
                            start = paginator.cur -1;
                            cnt = paginator.cur + 2;
                        }
                        
                        if (paginator.cur > paginator.sites - 3) {
                            start = 1;
                            cnt = 4;
                        }
                    } %>
                    <% for (i = start; i < cnt; i++) { %>
                    <li<% if (paginator.cur == i) {%> class="active"<% } %>><a<% if (paginator.cur != i) {%> href="/program?site=<%= i %><%= query %>"<% } %>><%= i %></a></li>
                    <% } %>
                    <% if (paginator.sites > 8) { %>
                    <li class="disabled"><a href="#">…</a></li>
                    <% for (i = paginator.sites - 2; i <= paginator.sites; i++) { %>
                    <li<% if (paginator.cur == i) {%> class="active"<% } %>><a<% if (paginator.cur != i) {%> href="/program?site=<%= i %><%= query %>"<% } %>><%= i %></a></li>
                    <% } %>
                    <% } %>
                    <li class="prev <% if (paginator.cur == paginator.sites) {%>disabled<% } %>">
                        <a<% if (paginator.cur != paginator.sites) {%> href="/program?site=<%= paginator.next %><%= query %>"<% } %>>Next →</a>
                    </li>
                </ul>
            </div>
        </div>
        <% } %>
    </div>
</div>

<div id="overlay" style="position: absolute; top: 0; left: 0; z-index: 101; display: none; color: #CCCCCC;">
    
</div>
<div id="dialog" class="modal" style="position: fixed; top: auto; left: auto; z-index: 101; display: none">
    <div class="modal-header">
        <h3>Switched</h3>
    </div>
    <div class="modal-body">
        <p>VDR switched to channel <%= channel.name %></p>
    </div>
    <div class="modal-footer">
        <a class="btn_ok btn primary">OK</a>
    </div>
</div>
<div id="errordialog" class="modal" style="position: fixed; top: auto; left: auto; z-index: 101; display: none">
    <div class="modal-header">
        <h3>Error occurred</h3>
    </div>
    <div class="modal-body">
        <p>Please try again</p>
    </div>
    <div class="modal-footer">
        <a class="btn_ok btn primary">OK</a>
    </div>
</div>