<script type="text/javascript">
    $(document).ready(function () {
        $(this).attr('title', 'VDRManager // <%= __("Timer") %>');

        $('.btn_timer').click(function () {
            if ($(this).attr('active') == "true") {
                $.ajax({
                    url: '<%= restfulUrl %>/timers?timer_id=' + $(this).attr('timerid') + '&flags=0',
                    type: 'PUT',
                    success: function () {
                        $(this).attr('src', '/img/devine/black/Circle-2.png');
                        $(this).attr('active', "true");
                    }
                });
            } else {
                $.ajax({
                    url: '<%= restfulUrl %>/timers',
                    type: 'PUT',
                    data: {
                        timer_id: $(this).attr('timerid'),
                        flags: 0
                    },
                    success: function () {
                        $(this).attr('src', '/img/devine/black/Circle-2.png');
                        $(this).attr('active', "true");
                    }
                });
            }
        });
    });
</script>

<div class="page-header">
    <h1>
        Timer
        <small>All the things you get</small>
    </h1>
</div>

<div class="row">
    <div class="span16 columns">
        <table class="zebra-striped">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    <th style="width: 120px;"><%= __('Airday') %></th>
                    <th style="width: 100px;"><%= __('Airtime') %></th>
                    <th style="width: 100px;"><%= __('Station') %></th>
                    <th>Title</th>
                </tr>
            </thead>
            <tbody>
                <% if (timers.length) {
                timers.forEach(function (timer, i) {
                    var timerDate = timer.day.split("-");
                    var date = new Date(timer.day);

                    var weekday = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');

                    timer.start.length;
                    if (timer.start.toString().length == 3) {
                        timer.start = '0' + timer.start.toString().substr(0,1) + ':' + timer.start.toString().substr(1,3);
                    }

                    if (timer.start.toString().length == 2) {
                        timer.start = '0' + timer.start.toString().substr(0,1) + ':0' + timer.start.toString().substr(1,2);
                    }

                    if (timer.start.toString().length == 4) {
                        timer.start = timer.start.toString().substr(0,2) + ':' + timer.start.toString().substr(2,4);
                    }

                    if (timer.stop.toString().length == 3) {
                        timer.stop = '0' + timer.stop.toString().substr(0,1) + ':' + timer.stop.toString().substr(1,3);
                    }

                    if (timer.stop.toString().length == 2) {
                        timer.stop = '0' + timer.stop.toString().substr(0,1) + ':0' + timer.stop.toString().substr(1,2);
                    }

                    if (timer.stop.toString().length == 4) {
                        timer.stop = timer.stop.toString().substr(0,2) + ':' + timer.stop.toString().substr(2,4);
                    }
                %>
                <tr>
                    <td style="width: 20px; text-align: center;"><img class="btn_timer" timerid="<%= timer.id %>" active="<%= timer.is_active %>" style="cursor: pointer;" src="/img/devine/black/<% if (timer.is_active) { %>Circle-2.png<% } else {%>Circle.png<% } %>" width="16px" height="16px" title="<% if (timer.is_active) { __('Disable this timer') } else { __('Enable this timer') } %>" /></td>
                    <td><%= timerDate[2] %>.<%= timerDate[1] %> <%= weekday[date.getDay()] %></td>
                    <td><%= timer.start %> - <%= timer.stop %></td>
                    <td><%= timer.channel_name %></td>
                    <td><%= timer.filename %></td>
                </tr>
                <% })
                }%>
            </tbody>
        </table>
        <% if (paginator.total > global.maxEntries) {
            var query = '&chan=';
        %>
        <div class="span16 columns">
            <div class="pagination" style="padding-left: 25%;">
                <ul>
                    <li class="prev <% if (paginator.cur == 1) {%>disabled<% } %>">
                        <a<% if (paginator.cur != 1) {%> href="/timer?site=<%= paginator.previous %><%= query %>"<% } %>>← <%= __('Previous') %></a>
                    </li>
                    <% var cnt = paginator.cur + 3;
                    var start = paginator.cur;
                    if (paginator.sites < 9) {
                        cnt = paginator.sites + 1;
                        start = 1;
                    } else {
                        if (paginator.cur != 1) {
                            start = paginator.cur -1;
                            cnt = paginator.cur + 2;
                        }

                        if (paginator.cur > paginator.sites - 3) {
                            start = 1;
                            cnt = 4;
                        }
                    } %>
                    <% for (i = start; i < cnt; i++) { %>
                    <li<% if (paginator.cur == i) {%> class="active"<% } %>><a<% if (paginator.cur != i) {%> href="/timer?site=<%= i %><%= query %>"<% } %>><%= i %></a></li>
                    <% } %>
                    <% if (paginator.sites > 8) { %>
                    <li class="disabled"><a href="#">…</a></li>
                    <% for (i = paginator.sites - 2; i <= paginator.sites; i++) { %>
                    <li<% if (paginator.cur == i) {%> class="active"<% } %>><a<% if (paginator.cur != i) {%> href="/timer?site=<%= i %><%= query %>"<% } %>><%= i %></a></li>
                    <% } %>
                    <% } %>
                    <li class="prev <% if (paginator.cur == paginator.sites) {%>disabled<% } %>">
                        <a<% if (paginator.cur != paginator.sites) {%> href="/timer?site=<%= paginator.next %><%= query %>"<% } %>><%= __('Next') %> →</a>
                    </li>
                </ul>
            </div>
        </div>
        <% } %>
    </div>
</div>