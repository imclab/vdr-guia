<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <title>Takeover</title>
        <meta http-equiv="content-type"
              content="text/html;charset=utf-8" />

        <!-- Include stylesheets -->
        <!-- Start installation -->
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.js"></script>
        
        <script type="text/javascript">
            /*!
             * Copyright (c) 2006 Brandon Aaron (brandon.aaron@gmail.com || http://brandonaaron.net)
             * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
             * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
             * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
             * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
             *
             * $LastChangedDate: 2007-12-20 09:02:08 -0600 (Thu, 20 Dec 2007) $
             * $Rev: 4265 $
             *
             * Version: 3.0
             * 
             * Requires: $ 1.2.2+
             */

            (function($) {

            $.event.special.mousewheel = {
                    setup: function() {
                            var handler = $.event.special.mousewheel.handler;
                            
                            // Fix pageX, pageY, clientX and clientY for mozilla
                            if ( $.browser.mozilla )
                                    $(this).bind('mousemove.mousewheel', function(event) {
                                            $.data(this, 'mwcursorposdata', {
                                                    pageX: event.pageX,
                                                    pageY: event.pageY,
                                                    clientX: event.clientX,
                                                    clientY: event.clientY
                                            });
                                    });
                    
                            if ( this.addEventListener )
                                    this.addEventListener( ($.browser.mozilla ? 'DOMMouseScroll' : 'mousewheel'), handler, false);
                            else
                                    this.onmousewheel = handler;
                    },
                    
                    teardown: function() {
                            var handler = $.event.special.mousewheel.handler;
                            
                            $(this).unbind('mousemove.mousewheel');
                            
                            if ( this.removeEventListener )
                                    this.removeEventListener( ($.browser.mozilla ? 'DOMMouseScroll' : 'mousewheel'), handler, false);
                            else
                                    this.onmousewheel = function(){};
                            
                            $.removeData(this, 'mwcursorposdata');
                    },
                    
                    handler: function(event) {
                            var args = Array.prototype.slice.call( arguments, 1 );
                            
                            event = $.event.fix(event || window.event);
                            // Get correct pageX, pageY, clientX and clientY for mozilla
                            $.extend( event, $.data(this, 'mwcursorposdata') || {} );
                            var delta = 0, returnValue = true;
                            
                            if ( event.wheelDelta ) delta = event.wheelDelta/120;
                            if ( event.detail     ) delta = -event.detail/3;
                            if ( $.browser.opera  ) delta = -event.wheelDelta;
                            
                            event.data  = event.data || {};
                            event.type  = "mousewheel";
                            
                            // Add delta to the front of the arguments
                            args.unshift(delta);
                            // Add event to the front of the arguments
                            args.unshift(event);

                            return $.event.handle.apply(this, args);
                    }
            };

            $.fn.extend({
                    mousewheel: function(fn) {
                            return fn ? this.bind("mousewheel", fn) : this.trigger("mousewheel");
                    },
                    
                    unmousewheel: function(fn) {
                            return this.unbind("mousewheel", fn);
                    }
            });

            })(jQuery);
            
            $(document).ready(function () {
                console.log($('#container').height());
                console.log($('#content').height());

                var scrollbarContainer= $('<div></div>').css({
                    width: 8,
                    position: 'absolute',
                    top: 0,
                    right: 0,
                    bottom: 0
                }).bind('mouseenter', function () {
                    scrollbar.fadeIn('fast');
                }).bind('mouseleave', function () {
                    if (scrollbar.data('mousedown') != true)
                        scrollbar.fadeOut('fast');
                });

                var scrollbar = $('<div></div>').css({
                    margin: '0px 1.5px 0px 1.5px',
                    height: $('#container').height() * ($('#container').height() / $('#content').height()),
                    borderRadius: 2.5,
                    backgroundColor: '#000000',
                    opacity: 0.3,
                    display: 'none'
                }).bind('mousedown', function (event) {
                    $(this).data('pos', event.clientY);
                    $(this).data('mousedown', true);
                }).bind('mouseup', function () {
                    $(this).data('mousedown', false);
                });

                $(document).bind('mousemove', function (event) {
                    if (scrollbar.data('mousedown')) {
                        if (scrollbar.data('pos') < event.clientY) {
                            if ((parseInt(scrollbar.css('margin-top')) + scrollbar.height()) < scrollbarContainer.height()) {
                                var pixel = Math.abs(event.clientY - scrollbar.data('pos'));

                                if ((parseInt(scrollbar.css('margin-top')) + scrollbar.height()) + pixel > scrollbarContainer.height()) {
                                    scrollbar.css('margin-top', parseInt(scrollbar.css('margin-top')) - scrollbar.height());
                                } else {
                                    scrollbar.css('margin-top', parseInt(scrollbar.css('margin-top')) + pixel);
                                }

                                
                                scrollbar.data('pos', event.clientY);
                            }
                        } else {
                            if (parseInt(scrollbar.css('margin-top')) > 0) {
                                var pixel = Math.abs(event.clientY - scrollbar.data('pos'));
                                scrollbar.css('margin-top', parseInt(scrollbar.css('margin-top')) - pixel);
                                scrollbar.data('pos', event.clientY);
                            }
                        }
                    }
                });

                scrollbarContainer.append(scrollbar);

                var timeoutId;

                $('#container').bind('mousewheel', function (event, delta) {
                    scrollbar.fadeIn('fast');

                    if ((parseInt(scrollbar.css('margin-top')) + scrollbar.height()) < scrollbarContainer.height() && delta < 0) {
                        console.log('SCROLL DOWN');
                        scrollbar.css('margin-top', parseInt(scrollbar.css('margin-top')) + 10);
                        $('#content').css('top', parseInt($('#content').css('top')) - 10);
                    }


                    if (parseInt(scrollbar.css('margin-top')) > 0 && delta > 0) {
                        console.log('SCROLL UP');
                        scrollbar.css('margin-top', parseInt(scrollbar.css('margin-top')) - 10);
                        $('#content').css('top', parseInt($('#content').css('top')) + 10);
                    }

                    console.log(delta);

                    //console.log($('#container').height() * ($('#container').height() / $('#content').height()));
                    clearTimeout(timeoutId);

                    timeoutId = setTimeout(function () {
                        scrollbar.fadeOut('fast');
                    }, 2000);
                }).append(scrollbarContainer);
            });
        </script>
    </head>

    <body>
        <div id="container" style="position:relative; overflow: hidden; height: 200px; border: 1px solid #000000;">
            <div id="content" style="height: 400px; position: absolute;">
                TEST
            </div>
        </div>
    </body>
</html>
